<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="FHGestimation">
<title>Traditional AHG fitting • FHGestimation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Traditional AHG fitting">
<meta property="og:description" content="FHGestimation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FHGestimation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mikejohnson51/FHGestimation/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Traditional AHG fitting</h1>
                        <h4 data-toc-skip class="author">Mike
Johnson</h4>
            <address class="author_afil">
      Lynker, NOAA-Affilate<br><small class="dont-index">Source: <a href="https://github.com/mikejohnson51/FHGestimation/blob/HEAD/vignettes/traditonal-ahg.Rmd" class="external-link"><code>vignettes/traditonal-ahg.Rmd</code></a></small>
      <div class="d-none name"><code>traditonal-ahg.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="the-ahg-relationships">The AHG relationships<a class="anchor" aria-label="anchor" href="#the-ahg-relationships"></a>
</h2>
<p>The idea of hydraulic geometry was introduced by Leopold and Maddock
(1953) and the concept of ‘at-a-station hydraulic geometry’ (AHG)
provides three power laws that relate water-surface width (TW), average
depth (Y), and average velocity (V) to the stream flow (Q) in a given
river cross section:</p>
<p><span class="math display">\[
TW = a *Q^b
\]</span> <span class="math display">\[
Y = c*Q^f
\]</span> <span class="math display">\[
V = k*Q^m
\]</span></p>
<p>A set of AHG relations applies to within-bank flows at a specific
cross section and assumes the channel characteristics do not change
sensibly with discharge. Under these assumptions, continuity dictates
that no water is gained or lost in the system such that:</p>
<p><span class="math display">\[
Q = TW·Y·V
\]</span></p>
<p>and therefore:</p>
<p><span class="math display">\[
b + f + m =  a·c·k = 1
\]</span></p>
<p>In practice, the enforcement of continuity is determined by the
quality of the data, and is not enforced in the estimation of the AHG
relationships.</p>
<div class="section level3">
<h3 id="traditonal-fitting-technique">Traditonal Fitting Technique<a class="anchor" aria-label="anchor" href="#traditonal-fitting-technique"></a>
</h3>
<p>While the AHG power laws provide an elegant theory for representing a
mass-constrained hydraulic system, the data available to determine these
relations are rarely as clean. In most cases, hydraulic data is reported
as a table(s) relating values of Q to values of one or more hydraulic
variables. Thus, the relationships require the power law relationships
to be fit,</p>
<p>AHG relations are historically fit using OLS on the logarithmic
transformation of the variables, where the exponential of the intercept
provides the power law coefficient, and the slope of the linear model
provides the exponent. Several studies have highlighted the potential
problem of using this approach [38] given that when the log transformed
values are back-transformed,the estimates are effectively medians, and
not means of the estimates, resulting in a general low bias.</p>
</div>
<div class="section level3">
<h3 id="example">Example:<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="va">nwis</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">(</span><span class="va">coef</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;   0.2004177</span></span>
<span></span>
<span><span class="op">(</span><span class="va">exp</span>  <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; log(data$Q) </span></span>
<span><span class="co">#&gt;   0.4797009</span></span></code></pre></div>
<p><img src="traditonal-ahg_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="section level4">
<h4 id="full-fits">Full Fits<a class="anchor" aria-label="anchor" href="#full-fits"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ols</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, <span class="va">name</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>             exp  <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>             name <span class="op">=</span> <span class="va">name</span>,</span>
<span>             row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>        <span class="fu">ols</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span>, <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, <span class="st">"Y"</span><span class="op">)</span>,</span>
<span>        <span class="fu">ols</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span>, <span class="va">data</span><span class="op">$</span><span class="va">TW</span>, <span class="st">"TW"</span><span class="op">)</span>,</span>
<span>        <span class="fu">ols</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span>, <span class="va">data</span><span class="op">$</span><span class="va">V</span>, <span class="st">"V"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         coef       exp name</span></span>
<span><span class="co">#&gt; 1  0.2004177 0.4797009    Y</span></span>
<span><span class="co">#&gt; 2 23.0100349 0.1104173   TW</span></span>
<span><span class="co">#&gt; 3  0.2155711 0.4093273    V</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="continuity-check">Continuity check<a class="anchor" aria-label="anchor" href="#continuity-check"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 0.9994455</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9941314</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="system-error">System Error<a class="anchor" aria-label="anchor" href="#system-error"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Yp  <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">Q</span> <span class="op">^</span> <span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         TWp <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">Q</span> <span class="op">^</span> <span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         Vp  <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">Q</span> <span class="op">^</span> <span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>         </span>
<span><span class="va">err</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Ye  <span class="op">=</span> <span class="fu"><a href="../reference/nrmse.html">nrmse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span>, <span class="va">data</span><span class="op">$</span><span class="va">Yp</span><span class="op">)</span>,</span>
<span>  TWe <span class="op">=</span> <span class="fu"><a href="../reference/nrmse.html">nrmse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">TW</span>, <span class="va">data</span><span class="op">$</span><span class="va">TWp</span><span class="op">)</span>,</span>
<span>  Ve  <span class="op">=</span> <span class="fu"><a href="../reference/nrmse.html">nrmse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">V</span>, <span class="va">data</span><span class="op">$</span><span class="va">Vp</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tot_error <span class="op">=</span> <span class="va">Ye</span> <span class="op">+</span> <span class="va">TWe</span> <span class="op">+</span> <span class="va">Ve</span>, type <span class="op">=</span> <span class="st">"OLS"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="traditonal-ahg_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mike Johnson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
