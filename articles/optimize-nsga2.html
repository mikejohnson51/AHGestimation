<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fine Tuning NSGA-2 • AHGestimation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fine Tuning NSGA-2">
<meta name="description" content='"Optimizing the NSGA-2 solver for AHG problems"
'>
<meta property="og:description" content='"Optimizing the NSGA-2 solver for AHG problems"
'>
<meta property="og:image" content="/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AHGestimation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mikejohnson51/AHGestimation/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="optimize-nsga2_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="optimize-nsga2_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="optimize-nsga2_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="optimize-nsga2_files/datatables-binding-0.33/datatables.js"></script><link href="optimize-nsga2_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="optimize-nsga2_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="optimize-nsga2_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="optimize-nsga2_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="optimize-nsga2_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fine Tuning NSGA-2</h1>
                        <h4 data-toc-skip class="author">Mike
Johnson</h4>
            <address class="author_afil">
      Lynker, NOAA-Affilate<br><small class="dont-index">Source: <a href="https://github.com/mikejohnson51/AHGestimation/blob/master/vignettes/optimize-nsga2.Rmd" class="external-link"><code>vignettes/optimize-nsga2.Rmd</code></a></small>
      <div class="d-none name"><code>optimize-nsga2.Rmd</code></div>
    </address>
</div>

    
    
<p>Evolutionary Algorithms are inspired by traits of biological
evolution including reproduction, mutation, recombination, and
selection. Possible solutions to a given problem act as members of a
population, while a prescribed fitness function determines the quality
of each member.</p>
<p>Evolutionary algorithms often perform well for all types of problems
because they do not make assumptions about the underlying fitness
landscape. That said, there are things we can do to (1) set expectations
about the fitness landscape (2) define an idealized population to solve
our given task and (3) understand the nuances of which EA implementation
we use (and how we use it)</p>
<p>Doing all of these well provides a more robust solver that can more
readily handle a range of inputs, without re calibration.</p>
<p>The solver we use the the <code>NSGA-2</code> solver implemented in
the <code>mco</code> package.</p>
<div class="section level2">
<h2 id="solver">Solver<a class="anchor" aria-label="anchor" href="#solver"></a>
</h2>
<p>We use NSGA-2 as prior experiments showed that solving AHG
relationship, in a mass conserving way, is often a multi-criterion
problem with a Pareto front of solutions.</p>
</div>
<div class="section level2">
<h2 id="defining-bounds">Defining bounds<a class="anchor" aria-label="anchor" href="#defining-bounds"></a>
</h2>
<p>The NSGA solver requests (but doesn’t require) a set of lower and
upper limits over which to search. Setting these helps limit the search
space, and therefore returns skilled solution more quickly (if at
all).</p>
<p>Our method for setting these bounds is as follows:</p>
<ol style="list-style-type: decimal">
<li>Fit NLS to each individual relation as prior work showed that in
every case NLS (seeded with OLS solutions) provides the best estimation
of an individual relationship but often fails to meet continuity.</li>
<li>Scale by set factor</li>
<li>This limits the exponent at coefficients to the range of {(1/scale)
* nls; scale * nls}</li>
</ol>
<p><img src="optimize-nsga2_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<p>The default for scale is 1.5, and if left to NULL the respective
parameters limits will be set to the maximums (+10%) found in Asfari
2018.</p>
</div>
<div class="section level2">
<h2 id="parameterizing-the-model">Parameterizing the model<a class="anchor" aria-label="anchor" href="#parameterizing-the-model"></a>
</h2>
<p>Fine tuning an evolutionary algorithm is a balancing act between time
to converge and accuracy.</p>
<p>In the NSGA-2 model there are 4 parameters that can be tuned:</p>
<ul>
<li>
<strong>Population Size</strong>: How many solutions are created in
each generation</li>
<li>
<strong>Generation</strong>: How many generations are created</li>
<li>
<strong>Cross over probability</strong>: Determines the likelihood
that crossover will occur between two parent solutions.</li>
<li>
<strong>Mutation probability</strong>: Determines the likelihood
that an individual will undergo the mutation process</li>
</ul>
</div>
<div class="section level2">
<h2 id="population-generation">Population &amp; Generation<a class="anchor" aria-label="anchor" href="#population-generation"></a>
</h2>
<p>First we will try to identify a optimal population and generation
size for this problem by holding the cross over and mutation
probabilities constant at the middle value of our total grid.</p>
<p>To do this, we build out a text matrix of <code>generation</code> and
<code>population</code> sizes, and use the default <code>mprob</code>
and <code>cprob</code> (all with a <code>seed</code> of 1).</p>
<p>The plot and table below show how solutions balance the % gain from
the “best” solution against time to solve. The effective Pareto front of
solutions is colored and labeled and all are equally valid solutions
depending on the desired goal (maximum speed, minimal error, some
balance)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seed</span>  <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">mprob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span></span>
<span><span class="va">cprob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.7</span><span class="op">)</span></span>
<span><span class="va">gen</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">24</span>, <span class="fl">32</span>, <span class="fl">48</span>, <span class="fl">96</span>, <span class="fl">144</span>, <span class="fl">192</span><span class="op">)</span></span>
<span><span class="va">pop</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span>, <span class="fl">500</span>, <span class="fl">700</span>, <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p><img src="optimize-nsga2_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],[192,96,144,96,192],[1000,1000,500,500,200],[30.57625,30.57958333333333,30.58625,30.59125,30.59916666666667],[24.7548400000087,12.13115999999456,9.162160000007134,6.00079999999376,4.773239999997895],[-0,0.01090170747993575,0.03270512243980725,0.04905768365970507,0.07494923892454811],["red","orange","purple","blue","green"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>gen<\/th>\n      <th>pop<\/th>\n      <th>total_error<\/th>\n      <th>time<\/th>\n      <th>percent_gain<\/th>\n      <th>col<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"gen","targets":1},{"name":"pop","targets":2},{"name":"total_error","targets":3},{"name":"time","targets":4},{"name":"percent_gain","targets":5},{"name":"col","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="cross-over-and-mutation-probability">Cross over and Mutation Probability<a class="anchor" aria-label="anchor" href="#cross-over-and-mutation-probability"></a>
</h2>
<p>Next, using our idealized generation and population size, we can turn
to the other two probabilistic inputs:</p>
<ul>
<li>Cross over</li>
<li>Mutation</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># high crossover, low mutation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># high-ish crossover, low-ish mutation (nearly mco default)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># moderate crossover, moderate mutation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p>Here, we tested the 15 combinations (3 probabilities, 5 gen/pop
combinations) for 25 gauged locations.</p>
<p>Below plot (A) shows the mean error of each combination across the 25
locations against the mean time to converge. Plot (B) shows the mean
variance in each grouping against the mean time to converge.</p>
<p><img src="optimize-nsga2_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],[10,15,5,12,2,11],[200,200,200,500,500,1000],[192,192,192,96,96,192],[0.2,0.4,0.05,0.4,0.05,0.4],[0.6,0.4,0.8,0.4,0.8,0.4],[30.61625,30.60958333333333,30.60416666666667,30.59791666666667,30.58375,30.57708333333333],[109.0270940217391,108.6085954710145,108.4531992753623,108.1644346014493,108.0420505434783,107.9895259057971],[5.883319999999367,5.902640000001993,6.205400000000372,7.134920000003185,7.541959999997634,29.65535999999149]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>label<\/th>\n      <th>pop<\/th>\n      <th>gen<\/th>\n      <th>mprob<\/th>\n      <th>cprob<\/th>\n      <th>total_error<\/th>\n      <th>mean_variation<\/th>\n      <th>time<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":8,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4,5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"label","targets":1},{"name":"pop","targets":2},{"name":"gen","targets":3},{"name":"mprob","targets":4},{"name":"cprob","targets":5},{"name":"total_error","targets":6},{"name":"mean_variation","targets":7},{"name":"time","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script><div class="section level4">
<h4 id="winner">Winner<a class="anchor" aria-label="anchor" href="#winner"></a>
</h4>
<p>The winner was the moderate crossover and mutation probability matrix
with a small population size and large generation count:</p>
<p><code>Combination 15:  pop = 200; gen = 192; cprob =     0.4; mprob =    0.4</code></p>
</div>
</div>
<div class="section level2">
<h2 id="influence-of-seed">Influence of Seed<a class="anchor" aria-label="anchor" href="#influence-of-seed"></a>
</h2>
<p>The only way to get repeatable results from an algorithm like
<code>nsga2</code> is to set a <code>seed</code>.</p>
<p>To illustrate this, and ensure the solution found above is not overly
sensitive to seed, we ran the algorithm 100 times using seeds 1 -
100.</p>
<p>Overall, 96% of the tests fell within 2.5% of the best solutions
error. In total there was a range of 0.76 total nRMSE across
solutions.</p>
<p>This give us confidence that the solution space defined is adequate
for solving this problem in a general way.</p>
<p><img src="optimize-nsga2_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="flexibility">Flexibility<a class="anchor" aria-label="anchor" href="#flexibility"></a>
</h2>
<p>Certainly, this in not a end all be all solution and different
objectives might want different solutions. In this case the following
options are exposed in <code>ahg_estimate</code>:</p>
<ul>
<li><p><strong>times</strong>: represents the number of times the
solution should be run with different seeds (<code>1:n()</code>) and is
exposed in <code>ahg_estimate</code></p></li>
<li><p><strong>gen</strong>: Number of generations to breed.</p></li>
<li><p><strong>pop</strong>: Size of population</p></li>
<li><p><strong>cprob</strong>: Crossover probability</p></li>
<li><p><strong>mprob</strong>: Mutation probability</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Johnson, Arash Modaresi Rad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
