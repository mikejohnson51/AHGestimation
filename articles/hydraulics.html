<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content='"Hydraulic Shape estimation"
'>
<title>Hydraulic Data Generation • AHGestimation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hydraulic Data Generation">
<meta property="og:description" content='"Hydraulic Shape estimation"
'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">AHGestimation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mikejohnson51/AHGestimation/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Hydraulic Data Generation</h1>
                        <h4 data-toc-skip class="author">Mike
Johnson</h4>
            <address class="author_afil">
      Lynker,
NOAA-Affilate<br><h4 data-toc-skip class="author">Arash
Modaresi Rad</h4>
            <address class="author_afil">
      Lynker, NOAA-Affilate<br><small class="dont-index">Source: <a href="https://github.com/mikejohnson51/AHGestimation/blob/HEAD/vignettes/hydraulics.Rmd" class="external-link"><code>vignettes/hydraulics.Rmd</code></a></small>
      <div class="d-none name"><code>hydraulics.Rmd</code></div>
    </address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="hydraulic-estimation">Hydraulic Estimation<a class="anchor" aria-label="anchor" href="#hydraulic-estimation"></a>
</h2>
<p>A primary application for AHG relations is hydraulic simulation and
approximation. AHG relationships are not only useful for translating one
hydraulic variable to an estimate of another, but they can be used to
parameterize the shape, roughness, and behavior of a channel for routing
applications applications (e.g. see Heldmeyer 2019)</p>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>Staring with the same data in other examples, we can retain the last
10 year of data and apply an NLS filter (see section of data filtering
for more)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">nwis</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date</span>, Q <span class="op">=</span> <span class="va">Q_cms</span>, Y <span class="op">=</span> <span class="va">Y_m</span>, TW <span class="op">=</span> <span class="va">TW_m</span>, V <span class="op">=</span> <span class="va">V_ms</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="../reference/date_filter.html">date_filter</a></span><span class="op">(</span><span class="fl">10</span>, keep_max <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="../reference/nls_filter.html">nls_filter</a></span><span class="op">(</span>allowance <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 85</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1987-04-07, 2013-01-17, 2013-04-04, 2013-06-11, 2013-08-19, 2013…</span></span>
<span><span class="co">#&gt; $ Q    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 317.1486864, 21.6907048, 40.2099227, 55.2178517, 8.8631731, 7.079…</span></span>
<span><span class="co">#&gt; $ Y    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.7651748, 0.8401875, 1.1666478, 1.5349831, 0.5720217, 0.5648958,…</span></span>
<span><span class="co">#&gt; $ TW   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 51.81600, 35.05200, 35.35680, 33.83280, 22.25040, 22.86000, 21.85…</span></span>
<span><span class="co">#&gt; $ V    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.624584, 0.737616, 0.975360, 1.063752, 0.697992, 0.545592, 0.466…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compute-roughness">Compute Roughness<a class="anchor" aria-label="anchor" href="#compute-roughness"></a>
</h3>
<p>Roughness defines the friction exerted by the stream bed on water
flowing through it. One way to estimate roughness is to solve Manning’s
equation:</p>
<p><span class="math display">\[
n = \frac{R^{2/3}S^{1/2}}{V}
\]</span></p>
<p>where V is velocity, R is hydraulic radius and S is longitudinal
slope.</p>
<p>We can use the smoothed reach-scale longitudinal slopes from the
NHDPlusv2 by extracting the value for the gage we used by combining the
<code>NLDI</code> and <code>get_vaa()</code> capabilities in
<code>nhdplusTools.</code></p>
<p>Following the assumptions made in the <a href="https://zenodo.org/record/7868764" class="external-link">HyG Dataset</a> we use the
median depth (Y) as an approximation for R, the median Velocity (V) from
the field measurement record. Thus, we report roughness which
approximates the historical median measured flow at each gage.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># channel slope extracted from NHDPlusV2 for corresponding location</span></span>
<span><span class="op">(</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_n.html">compute_n</a></span><span class="op">(</span><span class="va">data</span>, S <span class="op">=</span> <span class="fl">0.015</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1394096</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compute-r-d-r-and-p">Compute r, d, R and p<a class="anchor" aria-label="anchor" href="#compute-r-d-r-and-p"></a>
</h3>
<p>Dingman (2018) presented analytic derivations of the AHG parameters
and how the AHG coefficients are related to cross-section hydraulics and
geometry. Specifically 4 variables are called out:</p>
<div class="section level4">
<h4 id="r">r<a class="anchor" aria-label="anchor" href="#r"></a>
</h4>
<p>The exponent <code>r</code> reflects the cross-section shape where a
triangle is represented by r = 1, the ‘Lane Type B stable channel’
(Henderson, 1966) by r ≈1.75, a parabola by r = 2. As r →∞, the channel
becomes rectangular (Fig. 1). The value of <code>r</code> can be
computed as:</p>
<p><span class="math display">\[
r = f/b
\]</span></p>
<div class="figure">
<img src="../reference/figures/dingman-r.png" alt="Figure 1" width="100%"><p class="caption">
Figure 1
</p>
</div>
</div>
<div class="section level4">
<h4 id="p-q-k">p, q, k<a class="anchor" aria-label="anchor" href="#p-q-k"></a>
</h4>
<p>The exponent <code>p</code> (along with <code>q</code>) exist in
Chézy and Manning uniform-flow equations. In Chézy, <code>p</code> = 1/2
and Manning’s, <code>p</code> = 2/3 while in both Chézy and Manning
<code>q</code> = 1/2.</p>
<p>Since neither equation is generally dimensionally correct they
require unit adjustments. and several studies have indicated that p and
q have different values than assumed in the Chézy/Manning relations
[e.g. Riggs (1976), Dingman and Sharma (1997), Bjerklie et al. (2005),
Lopez et al. (2007), Ferguson (2007), Ferguson (2010)].</p>
<p><code>p</code> can be computed as:</p>
<p><span class="math display">\[
p = m/f
\]</span></p>
<p><strong>The general determination of κ and p from channel
characteristics (especially slope and boundary roughness) is a central
problem in open-channel hydraulics that has resisted simple
solution</strong>. In practice, coefficient κ and exponent p can be
determined by regression of <code>ln(V)</code> on <code>ln(Y)</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compute_ahg.html">compute_ahg</a></span><span class="op">(</span>Q <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>,  P <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">V</span>, type <span class="op">=</span> <span class="st">"kp"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">rename</span><span class="op">(</span>k <span class="op">=</span> <span class="va">coef</span>, p <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span>
<span><span class="co">#&gt;   type         p        k nrmse   pb method</span></span>
<span><span class="co">#&gt; 1   kp 0.5974488 0.781589  8.43 0.56    nls</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="d-r">d, R<a class="anchor" aria-label="anchor" href="#d-r"></a>
</h4>
<p><code>d</code>and <code>R</code> are derived parameters critical to
Dingman’s analytical expressions (Dingman 2018). They are based on
<code>r</code> and <code>p</code></p>
<p><span class="math display">\[
R ≡ (1 + r)/r
\]</span></p>
<p><span class="math display">\[
d ≡ 1 + r + rp
\]</span></p>
<p>To estimate the suite of these parameters, we provide the
<code>compute_hydraulic_params</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ahg_estimate.html">ahg_estimate</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_hydraulic_params.html">compute_hydraulic_params</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;            1</span></span>
<span><span class="co">#&gt; r  2.9348425</span></span>
<span><span class="co">#&gt; p  0.6014734</span></span>
<span><span class="co">#&gt; d  5.7000720</span></span>
<span><span class="co">#&gt; R  1.3407338</span></span>
<span><span class="co">#&gt; bd 0.1754364</span></span>
<span><span class="co">#&gt; fd 0.5148781</span></span>
<span><span class="co">#&gt; md 0.3096855</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="implications">Implications<a class="anchor" aria-label="anchor" href="#implications"></a>
</h3>
<p>If <code>r</code> is determined from the channel cross-section
geometry and <code>p</code> from the cross-section hydraulic relation,
we can write the AHG relations of in terms of the channel hydraulics and
geometry:</p>
<p><span class="math display">\[
W = BFW^{r+(r*p)} * (BFD/ R)^{-(1+p) / d} * Q^{1/d}
\]</span> <span class="math display">\[
Y = BFW^{r/d} * (BFD/ R)^{1 / d} * κ^{-r/d} * Q^{1/d}
\]</span></p>
<p><span class="math display">\[
V = BFW^{-(r*p)/d} * (BFD/ R)^{p / d} * κ^{(1+r)/d} * Q^{(-r*p)/d}
\]</span></p>
</div>
<div class="section level3">
<h3 id="generate-cross-sections">Generate Cross sections<a class="anchor" aria-label="anchor" href="#generate-cross-sections"></a>
</h3>
<p><img src="../reference/figures/dingman-bed.png" width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_section.html">cross_section</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">r</span>, </span>
<span>                    TW <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">TW</span><span class="op">)</span>, </span>
<span>                    Ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ind        x        Y         A</span></span>
<span><span class="co">#&gt; 1   1 0.000000 3.552589 133.70695</span></span>
<span><span class="co">#&gt; 2   2 1.040816 3.151475 113.69994</span></span>
<span><span class="co">#&gt; 3   3 2.081633 2.781429  96.01412</span></span>
<span><span class="co">#&gt; 4   4 3.122449 2.441240  80.46464</span></span>
<span><span class="co">#&gt; 5   5 4.163265 2.129691  66.87407</span></span>
<span><span class="co">#&gt; 6   6 5.204082 1.845565  55.07242</span></span></code></pre></div>
<p><img src="hydraulics_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mike Johnson, Arash Modaresi Rad.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
