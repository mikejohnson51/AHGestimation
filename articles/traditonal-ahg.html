<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Traditional AHG fitting • AHGestimation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Traditional AHG fitting">
<meta name="description" content='"Traditional AHG fitting using OLS"
'>
<meta property="og:description" content='"Traditional AHG fitting using OLS"
'>
<meta property="og:image" content="/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AHGestimation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mikejohnson51/AHGestimation/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Traditional AHG fitting</h1>
                        <h4 data-toc-skip class="author">Mike
Johnson</h4>
            <address class="author_afil">
      Lynker, NOAA-Affilate<br><small class="dont-index">Source: <a href="https://github.com/mikejohnson51/AHGestimation/blob/master/vignettes/traditonal-ahg.Rmd" class="external-link"><code>vignettes/traditonal-ahg.Rmd</code></a></small>
      <div class="d-none name"><code>traditonal-ahg.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="the-ahg-relationships">The AHG relationships<a class="anchor" aria-label="anchor" href="#the-ahg-relationships"></a>
</h2>
<p>The idea of hydraulic geometry was introduced by Leopold and Maddock
(1953) and the concept of ‘at-a-station hydraulic geometry’ (AHG)
provides three power laws that relate water-surface width (TW), average
depth (Y), and average velocity (V) to the stream flow (Q) in a given
river cross section:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>W</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><msup><mi>Q</mi><mi>b</mi></msup></mrow><annotation encoding="application/x-tex">
TW = a  \cdot Q^b
</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mi>c</mi><mo>⋅</mo><msup><mi>Q</mi><mi>f</mi></msup></mrow><annotation encoding="application/x-tex">
Y = c \cdot Q^f
</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>=</mo><mi>k</mi><mo>⋅</mo><msup><mi>Q</mi><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">
V = k \cdot Q^m
</annotation></semantics></math></p>
<p>A set of AHG relations applies to within-bank flows at a specific
cross section and assumes the channel characteristics do not change
sensibly with discharge. Under these assumptions, continuity dictates
that no water is gained or lost in the system such that:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo>=</mo><mi>T</mi><mi>W</mi><mo>·</mo><mi>Y</mi><mo>·</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">
Q = TW·Y·V
</annotation></semantics></math></p>
<p>and therefore:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>+</mo><mi>f</mi><mo>+</mo><mi>m</mi><mo>=</mo><mi>a</mi><mo>·</mo><mi>c</mi><mo>·</mo><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
b + f + m =  a·c·k = 1 
</annotation></semantics></math></p>
<p>In practice, the enforcement of continuity is determined by the
quality of the data, and is not enforced in the estimation of the AHG
relationships.</p>
<div class="section level3">
<h3 id="traditonal-fitting-technique">Traditonal Fitting Technique<a class="anchor" aria-label="anchor" href="#traditonal-fitting-technique"></a>
</h3>
<p>While the AHG power laws provide an elegant theory for representing a
mass-constrained hydraulic system, the data available to determine these
relations are rarely as clean. In most cases, hydraulic data is reported
as a table(s) relating values of Q to values of one or more hydraulic
variables. Thus, the relationships require the power law relationships
to be fit,</p>
<p>AHG relations are historically fit using OLS on the logarithmic
transformation of the variables, where the exponential of the intercept
provides the power law coefficient, and the slope of the linear model
provides the exponent. Several studies have highlighted the potential
problem of using this approach given that when the log transformed
values are back-transformed, the estimates are effectively medians, and
not means of the estimates, resulting in a general low bias.</p>
</div>
<div class="section level3">
<h3 id="example">Example:<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>  <span class="fu">AHGestimation</span><span class="fu">::</span><span class="va"><a href="../reference/nwis.html">nwis</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"Q_cms"</span>, <span class="st">"Y_m"</span>, <span class="st">"TW_m"</span>, <span class="st">"V_ms"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"Q"</span>, <span class="st">"Y"</span>, <span class="st">"TW"</span>, <span class="st">"V"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">(</span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;   0.2018376</span></span>
<span></span>
<span><span class="op">(</span><span class="va">exp</span>  <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; log(data$Q) </span></span>
<span><span class="co">#&gt;   0.4794202</span></span></code></pre></div>
<p><img src="traditonal-ahg_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
<div class="section level4">
<h4 id="full-fits">Full Fits<a class="anchor" aria-label="anchor" href="#full-fits"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ols</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, <span class="va">name</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>             exp  <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>             name <span class="op">=</span> <span class="va">name</span>,</span>
<span>             row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>        <span class="fu">ols</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span>, <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, <span class="st">"Y"</span><span class="op">)</span>,</span>
<span>        <span class="fu">ols</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span>, <span class="va">data</span><span class="op">$</span><span class="va">TW</span>, <span class="st">"TW"</span><span class="op">)</span>,</span>
<span>        <span class="fu">ols</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Q</span>, <span class="va">data</span><span class="op">$</span><span class="va">V</span>, <span class="st">"V"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         coef       exp name</span></span>
<span><span class="co">#&gt; 1  0.2018376 0.4794202    Y</span></span>
<span><span class="co">#&gt; 2 22.6153841 0.1145234   TW</span></span>
<span><span class="co">#&gt; 3  0.2178592 0.4056932    V</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="continuity-check">Continuity check<a class="anchor" aria-label="anchor" href="#continuity-check"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 0.9996368</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9944476</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="system-error">System Error<a class="anchor" aria-label="anchor" href="#system-error"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Yp  <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">Q</span> <span class="op">^</span> <span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         TWp <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">Q</span> <span class="op">^</span> <span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         Vp  <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">Q</span> <span class="op">^</span> <span class="va">x</span><span class="op">$</span><span class="va">exp</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>         </span>
<span><span class="va">err</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Ye  <span class="op">=</span> <span class="fu"><a href="../reference/nrmse.html">nrmse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span>, <span class="va">data</span><span class="op">$</span><span class="va">Yp</span><span class="op">)</span>,</span>
<span>  TWe <span class="op">=</span> <span class="fu"><a href="../reference/nrmse.html">nrmse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">TW</span>, <span class="va">data</span><span class="op">$</span><span class="va">TWp</span><span class="op">)</span>,</span>
<span>  Ve  <span class="op">=</span> <span class="fu"><a href="../reference/nrmse.html">nrmse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">V</span>, <span class="va">data</span><span class="op">$</span><span class="va">Vp</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tot_error <span class="op">=</span> <span class="va">Ye</span> <span class="op">+</span> <span class="va">TWe</span> <span class="op">+</span> <span class="va">Ve</span>, type <span class="op">=</span> <span class="st">"OLS"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="traditonal-ahg_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Johnson, Arash Modaresi Rad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
